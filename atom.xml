<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>杂货铺</title>
  <icon>https://www.gravatar.com/avatar/78dfb1fb53867356c0a9c9876dee56c6</icon>
  <subtitle>杂 - 九十八的杂</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://jjljyn.github.io/"/>
  <updated>2018-12-05T01:27:53.707Z</updated>
  <id>https://jjljyn.github.io/</id>
  
  <author>
    <name>Junliang Jia</name>
    <email>julianjia1009@gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CocosCreator坐标转换</title>
    <link href="https://jjljyn.github.io/2018/12/05/cocos-creator-coordinate-transformation/"/>
    <id>https://jjljyn.github.io/2018/12/05/cocos-creator-coordinate-transformation/</id>
    <published>2018-12-05T01:20:51.000Z</published>
    <updated>2018-12-05T01:27:53.707Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Cocos-Creator-坐标转换"><a href="#Cocos-Creator-坐标转换" class="headerlink" title="Cocos Creator 坐标转换"></a>Cocos Creator 坐标转换</h1><p>实现场景中某个子节点从A点移动到B点的动画</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> node = cc.find(<span class="string">'Canvas/node'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取世界坐标中心的坐标</span></span><br><span class="line"><span class="keyword">var</span> world_center = cc.find(<span class="string">'Canvas/bg'</span>).convertToWorldSpaceAR(cc.v2(<span class="number">0</span>,<span class="number">-50</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将世界中心转为相对父节点的坐标</span></span><br><span class="line"><span class="keyword">var</span> <span class="keyword">from</span> = seat.convertToNodeSpaceAR(world_center) ;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前 node 相对父节点的坐标</span></span><br><span class="line"><span class="keyword">var</span> to = node.getPosition();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 移动</span></span><br><span class="line">node.setPosition(<span class="keyword">from</span>);  <span class="comment">// 从场景中心</span></span><br><span class="line"><span class="keyword">var</span> action = cc.moveTo(<span class="number">0.5</span>, to);  <span class="comment">// 移动到node原来的位置</span></span><br><span class="line">node.runAction(action);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Cocos-Creator-坐标转换&quot;&gt;&lt;a href=&quot;#Cocos-Creator-坐标转换&quot; class=&quot;headerlink&quot; title=&quot;Cocos Creator 坐标转换&quot;&gt;&lt;/a&gt;Cocos Creator 坐标转换&lt;/h1&gt;&lt;p&gt;实现场景中某
      
    
    </summary>
    
    
      <category term="cocos" scheme="https://jjljyn.github.io/tags/cocos/"/>
    
      <category term="creator" scheme="https://jjljyn.github.io/tags/creator/"/>
    
  </entry>
  
  <entry>
    <title>Javascript设计模式4 -- 代理模式</title>
    <link href="https://jjljyn.github.io/2018/12/04/javascript-design-4/"/>
    <id>https://jjljyn.github.io/2018/12/04/javascript-design-4/</id>
    <published>2018-12-04T10:50:15.000Z</published>
    <updated>2018-12-04T11:54:04.971Z</updated>
    
    <content type="html"><![CDATA[<h1 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h1><p>代理模式是为一个对象提供一个代用品或占位符，以便控制对它的访问。</p><p>代理模式包括许多小分类，在JavaScript开发中最常用的是<strong>虚拟代理</strong>和<strong>缓存代理</strong>。</p><blockquote><p>代理模式的变体种类非常多，限于篇幅及其在JavaScript中的适用性只是介绍一下</p><ul><li>防火墙代理：控制网络资源的访问，保护主题不让“坏人”接近。</li><li>远程代理：为一个对象在不同的地址空间提供局部代表，在Java中，远程代理可以是另一个虚拟机中的对象。</li><li>保护代理：用于对象应该有不同访问权限的情况。</li><li>智能引用代理：取代了简单的指针，它在访问对象时执行一些附加操作，比如计算一个对象被引用的次数。</li><li>写时复制代理：通常用于复制一个庞大对象的情况。写时复制代理延迟了复制的过程，当对象被真正修改时，才对它进行复制操作。写时复制代理是虚拟代理的一种变体，DLL（操作系统中的动态链接库）是其典型运用场景。</li></ul></blockquote><h2 id="虚拟代理"><a href="#虚拟代理" class="headerlink" title="虚拟代理"></a>虚拟代理</h2><h3 id="虚拟代理实现图片预加载"><a href="#虚拟代理实现图片预加载" class="headerlink" title="虚拟代理实现图片预加载"></a>虚拟代理实现图片预加载</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 创建图片节点</span></span><br><span class="line"><span class="comment">* @type &#123;&#123;setSrc&#125;&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> myImage = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> imageNode = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(imageNode);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    setSrc: <span class="function"><span class="keyword">function</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">      imageNode.src = src;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 加载真实图片前，先显示加载图片</span></span><br><span class="line"><span class="comment">* @type &#123;&#123;setSrc&#125;&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> proxyImage = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">  img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    myImage.setSrc( <span class="keyword">this</span>.src );  <span class="comment">// 此处this指的是img，src指的是下面代码`img.src`</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    setSrc: <span class="function"><span class="keyword">function</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">      myImage.setSrc(<span class="string">'http://proxy.loading.png'</span>)</span><br><span class="line">      img.src = src;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">proxyImage.setSrc(<span class="string">'http://real.image.path.image.png'</span>);</span><br></pre></td></tr></table></figure><h3 id="虚拟代理合并HTTP请求"><a href="#虚拟代理合并HTTP请求" class="headerlink" title="虚拟代理合并HTTP请求"></a>虚拟代理合并HTTP请求</h3><p>假设点击勾选框发出请求，需要同步相应的资源。快速点击会发出大量请求造成后端很大压力。这里实现没两秒合并发送一次请求。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span>1</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"2"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span>2</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"3"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span>3</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"4"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span>4</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"5"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span>5</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"6"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span>6</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"7"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span>7</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"8"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span>8</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"9"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span>9</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> send = (<span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'合并发送请求，ID为:'</span>+id)</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> proxySend = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cache = [],  <span class="comment">// 暂时保存需要id</span></span><br><span class="line">      timer;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">    cache.push(id)</span><br><span class="line">    <span class="keyword">if</span>(timer)&#123;  <span class="comment">// 同一时间只能有一个time，以免被覆盖</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      send( cache.join(<span class="string">','</span>) );</span><br><span class="line">      timer = <span class="literal">null</span>;   <span class="comment">// 清除定时器</span></span><br><span class="line">      cache.length = <span class="number">0</span>;  <span class="comment">// 清空cache</span></span><br><span class="line">    &#125;, <span class="number">2000</span>)</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> checkBoxes = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'input'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>,box;box=checkBoxes[i++];)&#123;</span><br><span class="line">  box.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.checked === <span class="literal">true</span>)&#123;</span><br><span class="line">      proxySend(box.id)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="缓存代理"><a href="#缓存代理" class="headerlink" title="缓存代理"></a>缓存代理</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 创建乘积函数</span></span><br><span class="line"><span class="comment">* @return &#123;number&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> mult = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">arguments</span>.length; i++ )&#123;</span><br><span class="line">    a = a * <span class="built_in">arguments</span>[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 创建缓存代理函数</span></span><br><span class="line"><span class="comment">* @type &#123;function(): Function&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> proxyMult = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cache = &#123;&#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.join.call(<span class="built_in">arguments</span>, <span class="string">','</span>);  <span class="comment">// '1,2,3'</span></span><br><span class="line">    <span class="keyword">if</span>(args <span class="keyword">in</span> cache)&#123;  <span class="comment">// 如果cache中有键为'1,2,3'的值，则直接输出</span></span><br><span class="line">      <span class="keyword">return</span> cache[args];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cache[args] = mult.apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">proxyMult(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);  <span class="comment">// 经过mult函数</span></span><br><span class="line">proxyMult(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);  <span class="comment">// 直接从cache中取</span></span><br></pre></td></tr></table></figure><p>可以缓存代理用于ajax异步请求数据</p><p><code>本文内容摘自《Javascript设计模式与实际开发》，如有疑问请评论。</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;代理模式&quot;&gt;&lt;a href=&quot;#代理模式&quot; class=&quot;headerlink&quot; title=&quot;代理模式&quot;&gt;&lt;/a&gt;代理模式&lt;/h1&gt;&lt;p&gt;代理模式是为一个对象提供一个代用品或占位符，以便控制对它的访问。&lt;/p&gt;
&lt;p&gt;代理模式包括许多小分类，在JavaScrip
      
    
    </summary>
    
    
      <category term="JavaScript" scheme="https://jjljyn.github.io/tags/JavaScript/"/>
    
      <category term="设计模式" scheme="https://jjljyn.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="代理模式" scheme="https://jjljyn.github.io/tags/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Javascript设计模式3 -- 策略模式</title>
    <link href="https://jjljyn.github.io/2018/11/27/javascript-design-3/"/>
    <id>https://jjljyn.github.io/2018/11/27/javascript-design-3/</id>
    <published>2018-11-27T08:19:31.000Z</published>
    <updated>2018-12-04T10:52:24.999Z</updated>
    
    <content type="html"><![CDATA[<h1 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h1><p>策略模式的定义是：定义一系列的算法，把它们一个个封装起来，并且使它们可以相互替换。</p><blockquote><p>一个基于策略模式的程序至少由两部分组成。</p><ul><li>第一个部分是一组策略类，策略类封装了具体的算法，并负责具体的计算过程。 </li><li>第二个部分是环境类Context，Context接受客户的请求，随后把请求委托给某一个策略类。</li></ul></blockquote><p>以下假设实现游戏中角色使用不同枪械造成不同伤害，按照策略模式封装</p><h3 id="传统面向对象方式封装"><a href="#传统面向对象方式封装" class="headerlink" title="传统面向对象方式封装"></a>传统面向对象方式封装</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 封装 策略类</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 手枪：伤害系数为1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> Pistol = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">Pistol.prototype.shoot = <span class="function"><span class="keyword">function</span>(<span class="params">dps</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dps * <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 霰弹枪：伤害系数为2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> Shotgun = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">Shotgun.prototype.shoot = <span class="function"><span class="keyword">function</span>(<span class="params">dps</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dps * <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 加农炮：伤害系数为10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> Cannon = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">Cannon.prototype.shoot = <span class="function"><span class="keyword">function</span>(<span class="params">dps</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dps * <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 封装 武器类</span></span><br><span class="line"><span class="keyword">var</span> WeaponsStrategy = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>._dps = <span class="literal">null</span>;  <span class="comment">// 原始伤害</span></span><br><span class="line">    <span class="keyword">this</span>._weapon_type = <span class="literal">null</span>;  <span class="comment">// 武器类型</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置伤害值</span></span><br><span class="line"><span class="comment"> * @param &#123;伤害&#125; dps </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">WeaponsStrategy.prototype.setDps = <span class="function"><span class="keyword">function</span>(<span class="params">dps</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>._dps = dps</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置武器类型策略</span></span><br><span class="line"><span class="comment"> * @param &#123;类型&#125; type </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">WeaponsStrategy.prototype.setWeaponType = <span class="function"><span class="keyword">function</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>._weapon_type = type;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取伤害值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">WeaponsStrategy.prototype.getDps = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._weapon_type.shoot(<span class="keyword">this</span>._dps);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> strategy = <span class="keyword">new</span> WeaponsStrategy();</span><br><span class="line">strategy.setDps(<span class="number">100</span>);  <span class="comment">// 设置基础伤害</span></span><br><span class="line"></span><br><span class="line">strategy.setWeaponType(<span class="keyword">new</span> Pistol());  <span class="comment">// 设置 手枪 类型策略</span></span><br><span class="line"><span class="built_in">console</span>.log(strategy.getDps());     <span class="comment">// 输出：100</span></span><br><span class="line"></span><br><span class="line">strategy.setWeaponType(<span class="keyword">new</span> Shotgun());  <span class="comment">// 设置 霰弹枪 类型策略</span></span><br><span class="line"><span class="built_in">console</span>.log(strategy.getDps());      <span class="comment">// 输出：200</span></span><br><span class="line"></span><br><span class="line">strategy.setWeaponType(<span class="keyword">new</span> Cannon());  <span class="comment">// 设置 加农炮 类型策略</span></span><br><span class="line"><span class="built_in">console</span>.log(strategy.getDps());     <span class="comment">// 输出：1000</span></span><br></pre></td></tr></table></figure><h3 id="JavaScript-版本的策略模式"><a href="#JavaScript-版本的策略模式" class="headerlink" title="JavaScript 版本的策略模式"></a>JavaScript 版本的策略模式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将策略类作为函数对象</span></span><br><span class="line"><span class="keyword">var</span> strategy = &#123;</span><br><span class="line">  pistol: <span class="function"><span class="keyword">function</span>(<span class="params">dps</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dps * <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  shotgun: <span class="function"><span class="keyword">function</span>(<span class="params">dps</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dps * <span class="number">2</span></span><br><span class="line">  &#125;,</span><br><span class="line">  cannon: <span class="function"><span class="keyword">function</span>(<span class="params">dps</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dps * <span class="number">10</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 伤害输出</span></span><br><span class="line"><span class="keyword">var</span> damage = <span class="function"><span class="keyword">function</span>(<span class="params">type, dps</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> strategy[type](dps)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(damage(<span class="string">'pistol'</span>, <span class="number">10</span>)) <span class="comment">// 输出:100</span></span><br><span class="line"><span class="built_in">console</span>.log(damage(<span class="string">'shotgun'</span>, <span class="number">10</span>)) <span class="comment">// 输出:200</span></span><br><span class="line"><span class="built_in">console</span>.log(damage(<span class="string">'cannon'</span>, <span class="number">10</span>)) <span class="comment">// 输出:1000</span></span><br></pre></td></tr></table></figure><h3 id="策略模式实现表单验证"><a href="#策略模式实现表单验证" class="headerlink" title="策略模式实现表单验证"></a>策略模式实现表单验证</h3> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http:// xxx.com/register"</span> <span class="attr">id</span>=<span class="string">"registerForm"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">            请输入用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"userName"</span>/ &gt;</span></span><br><span class="line">            请输入密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"password"</span>/ &gt;</span></span><br><span class="line">            请输入手机号码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"phoneNumber"</span>/ &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">/***********************策略对象**************************/</span></span></span><br><span class="line"><span class="undefined">        </span></span><br><span class="line"><span class="javascript">    <span class="comment">// 封装验证规则</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> strategies = &#123;</span></span><br><span class="line"><span class="javascript">        isNonEmpty: <span class="function"><span class="keyword">function</span>(<span class="params"> value, errorMsg </span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> ( value === <span class="string">''</span> )&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> errorMsg;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="javascript">        minLength: <span class="function"><span class="keyword">function</span>(<span class="params"> value, length, errorMsg </span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> ( value.length &lt; length )&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> errorMsg;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="javascript">        isMobile: <span class="function"><span class="keyword">function</span>(<span class="params"> value, errorMsg </span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> ( !<span class="regexp">/(^1[3|5|8][0-9]&#123;9&#125;$)/</span>.test( value ) )&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> errorMsg;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">/***********************Validator 类**************************/</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 暂存数组</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> Validator = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.cache = [];</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 添加验证项</span></span></span><br><span class="line"><span class="javascript">    Validator.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params"> dom, rules </span>)</span>&#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> ( <span class="keyword">var</span> i = <span class="number">0</span>, rule; rule = rules[ i++ ]; )&#123;</span></span><br><span class="line"><span class="javascript">            (<span class="function"><span class="keyword">function</span>(<span class="params"> rule </span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> strategyAry = rule.strategy.split( <span class="string">':'</span> );  <span class="comment">// 例['isNotEmpty']或['minLength',  6]</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> errorMsg = rule.errorMsg;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">                self.cache.push(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> strategy = strategyAry.shift();  <span class="comment">// 顶部弹出策略名</span></span></span><br><span class="line"><span class="javascript">                    strategyAry.unshift( dom.value );  <span class="comment">// 顶部插入表单的value</span></span></span><br><span class="line"><span class="javascript">                    strategyAry.push( errorMsg );  <span class="comment">// 尾部插入errmsg，形成`(value,errmsg)`或者`(value,length,errmsg)`</span></span></span><br><span class="line"><span class="javascript">                    <span class="keyword">return</span> strategies[ strategy ].apply( <span class="literal">null</span>, strategyAry );</span></span><br><span class="line"><span class="undefined">                &#125;);</span></span><br><span class="line"><span class="undefined">            &#125;)( rule )</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 开始验证暂存数组的项</span></span></span><br><span class="line"><span class="javascript">    Validator.prototype.start = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> ( <span class="keyword">var</span> i = <span class="number">0</span>, validatorFunc; validatorFunc = <span class="keyword">this</span>.cache[ i++ ]; )&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> errorMsg = validatorFunc();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> ( errorMsg )&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> errorMsg;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">/***********************客户调用代码**************************/</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> registerForm = <span class="built_in">document</span>.getElementById( <span class="string">'registerForm'</span> );</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> validataFunc = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> validator = <span class="keyword">new</span> Validator();</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 对userName验证空和最小长度</span></span></span><br><span class="line"><span class="undefined">        validator.add( registerForm.userName, [&#123;</span></span><br><span class="line"><span class="javascript">            strategy: <span class="string">'isNonEmpty'</span>,</span></span><br><span class="line"><span class="javascript">            errorMsg: <span class="string">'用户名不能为空'</span></span></span><br><span class="line"><span class="undefined">        &#125;, &#123;</span></span><br><span class="line"><span class="javascript">            strategy: <span class="string">'minLength:10'</span>,</span></span><br><span class="line"><span class="javascript">            errorMsg: <span class="string">'用户名长度不能小于10位'</span></span></span><br><span class="line"><span class="undefined">        &#125;]);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 对password验证最小长度 </span></span></span><br><span class="line"><span class="undefined">        validator.add( registerForm.password, [&#123;</span></span><br><span class="line"><span class="javascript">            strategy: <span class="string">'minLength:6'</span>,</span></span><br><span class="line"><span class="javascript">            errorMsg: <span class="string">'密码长度不能小于6位'</span></span></span><br><span class="line"><span class="undefined">        &#125;]);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 对phoneNumber验证合法性</span></span></span><br><span class="line"><span class="undefined">        validator.add( registerForm.phoneNumber, [&#123;</span></span><br><span class="line"><span class="javascript">            strategy: <span class="string">'isMobile'</span>,</span></span><br><span class="line"><span class="javascript">            errorMsg: <span class="string">'手机号码格式不正确'</span></span></span><br><span class="line"><span class="undefined">        &#125;]);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> errorMsg = validator.start();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> errorMsg;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 表达提交时验证并对错误提示</span></span></span><br><span class="line"><span class="javascript">    registerForm.onsubmit = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">         <span class="keyword">var</span> errorMsg = validataFunc();</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">         <span class="keyword">if</span> ( errorMsg )&#123;</span></span><br><span class="line"><span class="undefined">              alert ( errorMsg );</span></span><br><span class="line"><span class="javascript">              <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="undefined">         &#125;</span></span><br><span class="line"><span class="undefined">     &#125;;</span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="undefined">     </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>本文内容摘自《Javascript设计模式与实际开发》，如有疑问请评论。</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;策略模式&quot;&gt;&lt;a href=&quot;#策略模式&quot; class=&quot;headerlink&quot; title=&quot;策略模式&quot;&gt;&lt;/a&gt;策略模式&lt;/h1&gt;&lt;p&gt;策略模式的定义是：定义一系列的算法，把它们一个个封装起来，并且使它们可以相互替换。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;
      
    
    </summary>
    
    
      <category term="JavaScript" scheme="https://jjljyn.github.io/tags/JavaScript/"/>
    
      <category term="设计模式" scheme="https://jjljyn.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="策略模式" scheme="https://jjljyn.github.io/tags/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Javascript设计模式2 -- 单例模式</title>
    <link href="https://jjljyn.github.io/2018/11/20/javascript-design-2/"/>
    <id>https://jjljyn.github.io/2018/11/20/javascript-design-2/</id>
    <published>2018-11-20T12:48:58.000Z</published>
    <updated>2018-12-04T10:51:39.418Z</updated>
    
    <content type="html"><![CDATA[<h1 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h1><blockquote><p>定义：<em>保证一个类仅有一个实例，并提供一个访问它的全局访问点。</em></p></blockquote><blockquote><p>场景：当单击登录按钮的时候，页面中会出现一个登录浮窗，而这个登录浮窗是唯一的，无论单击多少次登录按钮，这个浮窗都只会被创建一次，那么这个登录浮窗就适合用单例模式来创建。</p></blockquote><h2 id="实现单例模式"><a href="#实现单例模式" class="headerlink" title="实现单例模式"></a>实现单例模式</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Singleton = <span class="function"><span class="keyword">function</span>(<span class="params"> name </span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Singleton.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log ( <span class="keyword">this</span>.name );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Singleton.getInstance = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> instance = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"> name </span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ( !instance )&#123;</span><br><span class="line">            instance = <span class="keyword">new</span> Singleton( name );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a  =  Singleton.getInstance(<span class="string">'sven1'</span>);</span><br><span class="line">a.getName()  <span class="comment">// 输出：sven1</span></span><br><span class="line"><span class="keyword">var</span> b = Singleton.getInstance(<span class="string">'sven2'</span>);</span><br><span class="line">b.getName()  <span class="comment">// 输出：sven1</span></span><br></pre></td></tr></table></figure><h2 id="JavaScript中的单例模式"><a href="#JavaScript中的单例模式" class="headerlink" title="JavaScript中的单例模式"></a>JavaScript中的单例模式</h2><p>JavaScript其实是一门无类（class-free）语言，也正因为如此，生搬单例模式的概念并无意义。在JavaScript中创建对象的方法非常简单，既然我们只需要一个“唯一”的对象，为什么要为它先创建一个“类”呢？这无异于穿棉衣洗澡，传统的单例模式实现在JavaScript中并不适用。</p><p>单例模式的核心是确保只有一个实例，并提供全局访问。</p><h3 id="使用命名空间"><a href="#使用命名空间" class="headerlink" title="使用命名空间"></a>使用命名空间</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> MyApp = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">MyApp.namespace = <span class="function"><span class="keyword">function</span>(<span class="params"> name </span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> parts = name.split( <span class="string">'.'</span> );</span><br><span class="line">    <span class="keyword">var</span> current = MyApp;  <span class="comment">// 由于JavaScript对象赋值是深拷贝，所以current改变则MyApp改变</span></span><br><span class="line">    <span class="keyword">for</span> ( <span class="keyword">var</span> i <span class="keyword">in</span> parts )&#123;</span><br><span class="line">        <span class="keyword">if</span> ( !current[ parts[ i ] ] )&#123;</span><br><span class="line">            current[ parts[ i ] ] = &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        current = current[ parts[ i ] ];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">MyApp.namespace( <span class="string">'event'</span> );</span><br><span class="line">MyApp.namespace( <span class="string">'dom.style'</span> );</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(MyApp)  </span><br><span class="line"><span class="comment">/* 输出：</span></span><br><span class="line"><span class="comment">* &#123;</span></span><br><span class="line"><span class="comment">*   namespace: f (name),</span></span><br><span class="line"><span class="comment">*   event: &#123;&#125;,</span></span><br><span class="line"><span class="comment">*   dom:&#123;</span></span><br><span class="line"><span class="comment">*       style: &#123;&#125;</span></span><br><span class="line"><span class="comment">*     &#125;</span></span><br><span class="line"><span class="comment">* &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="使用闭包封装私有变量"><a href="#使用闭包封装私有变量" class="headerlink" title="使用闭包封装私有变量"></a>使用闭包封装私有变量</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> user = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> __name = <span class="string">'sven'</span>,  <span class="comment">// 常用 __name 和 __age 表示私有变量</span></span><br><span class="line">        __age = <span class="number">29</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        getUserInfo: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> __name + <span class="string">'-'</span> + __age;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h2 id="惰性单例"><a href="#惰性单例" class="headerlink" title="惰性单例"></a>惰性单例</h2><p><em>惰性单例指的是在需要的时候才创建对象实例</em>。</p><p>当点击【登录】按钮时再去创建悬浮框<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"loginBtn"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> createLoginLayer = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> div;                            <span class="comment">// 用div变量标识是否已经创建了悬浮框</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> ( !div )&#123;</span></span><br><span class="line"><span class="javascript">                div = <span class="built_in">document</span>.createElement( <span class="string">'div'</span> );</span></span><br><span class="line"><span class="javascript">                div.innerHTML = <span class="string">'我是登录浮窗'</span>;</span></span><br><span class="line"><span class="javascript">                div.style.display = <span class="string">'none'</span>;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">document</span>.body.appendChild( div );</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> div;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;)();</span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.getElementById( <span class="string">'loginBtn'</span> ).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> loginLayer = createLoginLayer();</span></span><br><span class="line"><span class="javascript">        loginLayer.style.display = <span class="string">'block'</span>;</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h2 id="通用的惰性单例"><a href="#通用的惰性单例" class="headerlink" title="通用的惰性单例"></a>通用的惰性单例</h2><p>把<em>创建实例对象</em>的职责和<em>管理单例的职责</em>分别放置在两个方法里，这两个方法可以独立变化而互不影响，</p><p>但是它们连接在一起的时候，就完成了创建唯一实例对象的功能。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 管理单例职责</span></span><br><span class="line"><span class="comment">* 将如下部分提取出来</span></span><br><span class="line"><span class="comment">* var obj;</span></span><br><span class="line"><span class="comment">* if(!obj) &#123; obj = xxx; &#125;</span></span><br><span class="line"><span class="comment">* return obj</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> getSingle = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> single;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> result || ( result = fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>) )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 创建实例对象</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> createLayout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 创建登录悬浮窗</span></span><br><span class="line">  <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">  div.innerHTML = <span class="string">'我是登录悬浮窗口'</span>;</span><br><span class="line">  div.display = <span class="string">'none'</span>;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild( div );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'loginBtn'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> loginBox = getSingle( createLayout() );</span><br><span class="line">  loginBox.display = <span class="string">'block'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>本文内容摘自《Javascript设计模式与实际开发》，如有疑问请评论。</code></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;单例模式&quot;&gt;&lt;a href=&quot;#单例模式&quot; class=&quot;headerlink&quot; title=&quot;单例模式&quot;&gt;&lt;/a&gt;单例模式&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;定义：&lt;em&gt;保证一个类仅有一个实例，并提供一个访问它的全局访问点。&lt;/em&gt;&lt;/p&gt;
&lt;/blo
      
    
    </summary>
    
    
      <category term="JavaScript" scheme="https://jjljyn.github.io/tags/JavaScript/"/>
    
      <category term="设计模式" scheme="https://jjljyn.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="单例模式" scheme="https://jjljyn.github.io/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Shell杀死指定进程</title>
    <link href="https://jjljyn.github.io/2018/11/14/shell-kill-specified-process/"/>
    <id>https://jjljyn.github.io/2018/11/14/shell-kill-specified-process/</id>
    <published>2018-11-14T02:47:07.000Z</published>
    <updated>2018-11-15T01:32:00.898Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用法：</span></span><br><span class="line"><span class="comment"># $ bash kill_all.sh configs_local.js</span></span><br><span class="line"></span><br><span class="line">NAME=<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$1</span> ];<span class="keyword">then</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Hint enter for default process name 'configs_local.js'."</span></span><br><span class="line"><span class="built_in">read</span></span><br><span class="line">NAME=<span class="string">'configs_local.js'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"Do you really want to kill all process which is match '<span class="variable">$NAME</span>'?(Y/n)."</span> -n 1 FLAG</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\n"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="string">"<span class="variable">$FLAG</span>"</span> &amp;&amp; <span class="variable">$FLAG</span> = <span class="string">'Y'</span> ]];</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Process name include '<span class="variable">$NAME</span>' "</span></span><br><span class="line">ID=`ps -ef | grep <span class="string">"<span class="variable">$NAME</span>"</span> | grep -v <span class="string">"<span class="variable">$0</span>"</span> | grep -v <span class="string">"grep"</span> | awk <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$ID</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"---------------"</span></span><br><span class="line"><span class="keyword">for</span> id <span class="keyword">in</span> <span class="variable">$ID</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">kill</span> -9 <span class="variable">$id</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"killed <span class="variable">$id</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"---------------"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Bye Bye'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><ol><li>将之保存为<code>killprocess.sh</code></li><li>调用<code>./killprocess.sh programmename</code>。其中<code>programme</code>可以为程序名字，也可以是启动程序时的命令行，只要能在<code>ps -ef | grep programmename</code> 之后出现所有的该程序对应的进程即可</li></ol><blockquote><p><code>awk</code>命令简介：<br>awk是一个强大的文本分析工具，相对于grep的查找，sed的编辑，awk在其对数据分析并生成报告时，显得尤为强大。简单来说awk就是把文件逐行的读入，以空格为默认分隔符将每行切片，切开的部分再进行各种分析处理。</p></blockquote><p>基础用法见：<a href="https://www.cnblogs.com/ggjucheng/archive/2013/01/13/2858470.html" target="_blank" rel="noopener">linux awk命令详解</a>。</p><p>详习用法见：<a href="http://www.gnu.org/software/gawk/manual/gawk.html" target="_blank" rel="noopener">The GNU Awk User’s Guide</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=
      
    
    </summary>
    
    
      <category term="shell" scheme="https://jjljyn.github.io/tags/shell/"/>
    
      <category term="node.js" scheme="https://jjljyn.github.io/tags/node-js/"/>
    
  </entry>
  
  <entry>
    <title>this、call和apply</title>
    <link href="https://jjljyn.github.io/2018/11/13/this-call-apply/"/>
    <id>https://jjljyn.github.io/2018/11/13/this-call-apply/</id>
    <published>2018-11-13T04:43:39.000Z</published>
    <updated>2018-11-13T12:02:53.394Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><code>JavaScript</code>中的<code>this</code>总是指向一个对象，具体指向哪个对象是<strong>「在运行时基于函数的执行环境动态绑定的，而非函数被声明时的环境」。</strong></p></blockquote><h1 id="this"><a href="#this" class="headerlink" title="this"></a>this</h1><p><code>this</code>的指向大致分为四种：</p><h2 id="1-作为对象的方法引用"><a href="#1-作为对象的方法引用" class="headerlink" title="1. 作为对象的方法引用"></a>1. 作为对象的方法引用</h2><p>当某个对象中有函数作为属性并且被调用时，函数中的<code>this</code>会指向当前对象。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  a:<span class="number">1</span>,</span><br><span class="line">  getA: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span> === obj)   <span class="comment">// 输出：true </span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a)   <span class="comment">//  输出：1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h2 id="2-作为普通函数调用"><a href="#2-作为普通函数调用" class="headerlink" title="2. 作为普通函数调用"></a>2. 作为普通函数调用</h2><p>普通的函数中包含<code>this</code>并且被调用时，<code>this</code>总是指向全局对象。浏览器中的全局对象就是<code>window</code>对象。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.name = <span class="string">'window'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(getName())  <span class="comment">// 输出：window</span></span><br></pre></td></tr></table></figure></p><h2 id="3-构造器调用"><a href="#3-构造器调用" class="headerlink" title="3. 构造器调用"></a>3. 构造器调用</h2><p><strong>Javascript中没有类</strong>，但是可以从构造器中创建对象，同时也提供了<code>new</code>运算符，使得构造器看起来更像一个类。<br>当用<code>new</code>运算符调用函数时，总会返回一个对象，通常情况下，构造器里的<code>this</code>就指向返回的这个对象。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = <span class="string">'steven'</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> name();</span><br><span class="line"><span class="built_in">console</span>.log(obj.name)  <span class="comment">//输出：steven</span></span><br></pre></td></tr></table></figure></p><p>但用<code>new</code>调用构造器时，需要注意如果<strong>显式</strong>的返回一个<code>object</code>对象，那么<code>this</code>会指向这个返回的对象。如果显式返回一个非<code>object</code>的类型则不会影响。<br>var name = function() {<br>  this.name = ‘steven’;<br>  return {<br>    name: ‘John’<br>  }<br>};</p><p>var obj = new name();<br>console.log(obj.name)  //输出：John</p><h2 id="4-Function-prototype-call或者Function-prototype-apply调用"><a href="#4-Function-prototype-call或者Function-prototype-apply调用" class="headerlink" title="4.  Function.prototype.call或者Function.prototype.apply调用"></a>4.  <code>Function.prototype.call</code>或者<code>Function.prototype.apply</code>调用</h2><p>用<code>Function.prototype.call</code>或者<code>Function.prototype.apply</code>可以动态改变传入函数的<code>this</code>。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person1 = &#123;</span><br><span class="line">  name: <span class="string">'steven'</span>,</span><br><span class="line">  getName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person2 = &#123;</span><br><span class="line">  name: <span class="string">'John'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person1.getName())  <span class="comment">// 输出：steven</span></span><br><span class="line"><span class="built_in">console</span>.log(person1.getName.call(person2))   <span class="comment">// 输出：John</span></span><br></pre></td></tr></table></figure></p><h1 id="call和apply的区别"><a href="#call和apply的区别" class="headerlink" title="call和apply的区别"></a>call和apply的区别</h1><p><code>Function.prototype.call</code>和<code>Function.prototype.apply</code>都是非常常用的方法。它们的作用一模一样，区别仅在于传入参数形式的不同。</p><p>详细用法参见<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/call" target="_blank" rel="noopener">MDN web docs Function.prototype.call</a>、<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/apply" target="_blank" rel="noopener">MDN web docs Function.prototype.apply</a></p><h1 id="call和apply的用途"><a href="#call和apply的用途" class="headerlink" title="call和apply的用途"></a>call和apply的用途</h1><h2 id="1-改变this指向"><a href="#1-改变this指向" class="headerlink" title="1. 改变this指向"></a>1. 改变<code>this</code>指向</h2><h3 id="‘丢失’的this"><a href="#‘丢失’的this" class="headerlink" title="‘丢失’的this"></a>‘丢失’的<code>this</code></h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div1"</span>&gt;</span>我是一个div<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> getId = <span class="built_in">document</span>.getElementById;</span></span><br><span class="line"><span class="javascript">    getId( <span class="string">'div1'</span> );</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>上述代码执行时会报错，因为调用<code>getId()</code>时，相当于调用普通函数，则<code>document.getElementById</code>中内部实现需要用到的<code>this</code>默认指向全家对象<code>window</code>并不是原本期望的<code>document</code>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById = (<span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fn.apply(<span class="built_in">document</span>, <span class="built_in">arguments</span>)  <span class="comment">// apply 中第一个参数 document 就是将 document.getElementById内部的this指向到document</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(<span class="built_in">document</span>.getElementById);  <span class="comment">// 这里括号内的方法 document.getElementById 就是上方的 fn</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> getId = <span class="built_in">document</span>.getElementById;</span><br><span class="line">getId(<span class="string">'div'</span>)</span><br></pre></td></tr></table></figure><blockquote><p><code>(function(){ /* code */})();</code>是<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/%E7%AB%8B%E5%8D%B3%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F" target="_blank" rel="noopener">IIFE立即执行函数模式</a>语法，可以让函数在定义后立即被执行。<br>第一部分是包围在圆括号运算符()里的一个匿名函数，这个匿名函数拥有独立的词法作用域。这不仅避免了外界访问此 IIFE 中的变量，而且又不会污染全局作用域。<br>  第二部分再一次使用 () 创建了一个立即执行函数表达式，JavaScript 引擎到此将直接执行函数。</p></blockquote><h2 id="2-Function-prototype-bind"><a href="#2-Function-prototype-bind" class="headerlink" title="2. Function.prototype.bind"></a>2. <code>Function.prototype.bind</code></h2><p>大部分高级浏览器都实现了内置的<code>Function.prototype.bind</code>，用来指定函数内部的<code>this</code>指向，我们来实现一下<code>Function.prototype.bind</code>，代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span>(<span class="params"> context </span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;        <span class="comment">// 保存原函数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;        <span class="comment">// 返回一个新的函数</span></span><br><span class="line">        <span class="keyword">return</span> self.apply( context, <span class="built_in">arguments</span> );    <span class="comment">// 执行新的函数的时候，会把之前传入的context</span></span><br><span class="line">                                                    <span class="comment">// 当作新函数体内的this</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    name: <span class="string">'sven'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log ( <span class="keyword">this</span>.name );    <span class="comment">// 输出：sven</span></span><br><span class="line">&#125;.bind( obj);</span><br><span class="line"></span><br><span class="line">func();</span><br></pre></td></tr></table></figure><h2 id="3-借用其他对象的方法"><a href="#3-借用其他对象的方法" class="headerlink" title="3. 借用其他对象的方法"></a>3. 借用其他对象的方法</h2><p>函数的参数列表<code>arguments</code>是一个类数组对象，虽然它也有“下标”，但它并非真正的数组，所以也不能像数组一样，进行排序操作或者往集合里添加一个新的元素。这种情况下，我们常常会借用<code>Array.prototype</code>对象上的方法。比如想往<code>arguments</code>中添加一个新的元素，通常会借用<code>Array.prototype.push</code>：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);   <span class="comment">// 输出：Arguments(2) [1,2]</span></span><br><span class="line">  <span class="built_in">Array</span>.prototype.push.call( <span class="built_in">arguments</span>, <span class="number">3</span> );</span><br><span class="line">  <span class="built_in">console</span>.log ( <span class="built_in">arguments</span> );    <span class="comment">// 输出：Arguments(3) [1,2,3]</span></span><br><span class="line">&#125;)( <span class="number">1</span>, <span class="number">2</span> );</span><br></pre></td></tr></table></figure></p><blockquote><p><code>本文内容摘自《Javascript设计模式与实际开发》，如有疑问请评论。</code></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;JavaScript&lt;/code&gt;中的&lt;code&gt;this&lt;/code&gt;总是指向一个对象，具体指向哪个对象是&lt;strong&gt;「在运行时基于函数的执行环境动态绑定的，而非函数被声明时的环境」。&lt;/strong&gt;&lt;/p&gt;
&lt;/blockqu
      
    
    </summary>
    
    
      <category term="Javascript" scheme="https://jjljyn.github.io/tags/Javascript/"/>
    
  </entry>
  
  <entry>
    <title>Javascript设计模式1 -- 原型模式</title>
    <link href="https://jjljyn.github.io/2018/11/06/javascript-design-1/"/>
    <id>https://jjljyn.github.io/2018/11/06/javascript-design-1/</id>
    <published>2018-11-06T14:11:32.000Z</published>
    <updated>2018-12-04T10:52:02.224Z</updated>
    
    <content type="html"><![CDATA[<h3 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h3><p>原型模式是一种设计模式，也是一种编程泛型，它构成了JavaScript这门语言的根本。</p><p>原型模式的实现关键，是语言本身是否提供了<code>clone</code>方法。ECMAScript5提供了<code>Object.create</code>方法，可以用来克隆对象。代码如下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例如是在写一个飞机大战的游戏</span></span><br><span class="line"><span class="keyword">var</span> Plane = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.blood = <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">this</span>.attackLevel = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">this</span>.defenseLevel = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> plane =  <span class="keyword">new</span> Plane();</span><br><span class="line">plane.blood = <span class="number">500</span>;</span><br><span class="line">plane.attackLevel = <span class="number">10</span>;</span><br><span class="line">plane.defenseLevel = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> clonePlane = <span class="built_in">Object</span>.create(plane);</span><br><span class="line"><span class="built_in">console</span>.log(clonePlane.blood)  <span class="comment">// 500</span></span><br><span class="line"><span class="built_in">console</span>.log(clonePlane.attackLevel)   <span class="comment">// 10</span></span><br><span class="line"><span class="built_in">console</span>.log(clonePlane.defenseLevel)  <span class="comment">// 5</span></span><br></pre></td></tr></table></figure></p><p>在不支持<code>Object.create</code>方法的浏览器中，则可以使用以下代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.create = <span class="built_in">Object</span>.create || <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">  fn.prototype = obj;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> fn();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="原型编程范型的一些规则"><a href="#原型编程范型的一些规则" class="headerlink" title="原型编程范型的一些规则"></a>原型编程范型的一些规则</h3><p>JavaScript本身是一门基于原型的面向对象语言，它的对象系统就是使用原型模式来搭建的。所以原型模式不仅仅是一种设计模式，也是一种编程范型。</p><p>原型编程中的一个重要特性，即当对象无法响应某个请求时，会把该请求委托给它自己的原型。</p><p>原型编程范型至少包括以下基本规则：</p><ul><li>所有数据都是对象</li><li>要得到一个对象，不是用过实例化类，而是找到一个对象作为原型并克隆它</li><li>对象会记住它的原型</li><li>如果对象无法响应某个请求，它会把这个请求委托给自己的原型。</li></ul><blockquote><p><code>本文内容摘自《Javascript设计模式与实际开发》，如有疑问请评论。</code></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;原型模式&quot;&gt;&lt;a href=&quot;#原型模式&quot; class=&quot;headerlink&quot; title=&quot;原型模式&quot;&gt;&lt;/a&gt;原型模式&lt;/h3&gt;&lt;p&gt;原型模式是一种设计模式，也是一种编程泛型，它构成了JavaScript这门语言的根本。&lt;/p&gt;
&lt;p&gt;原型模式的实现关键，是
      
    
    </summary>
    
    
      <category term="JavaScript" scheme="https://jjljyn.github.io/tags/JavaScript/"/>
    
      <category term="设计模式" scheme="https://jjljyn.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="原型模式" scheme="https://jjljyn.github.io/tags/%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>新的开始</title>
    <link href="https://jjljyn.github.io/2018/11/01/hello-world/"/>
    <id>https://jjljyn.github.io/2018/11/01/hello-world/</id>
    <published>2018-10-31T16:31:11.863Z</published>
    <updated>2018-10-31T16:31:11.863Z</updated>
    
    <content type="html"><![CDATA[<h3 id="新的开始"><a href="#新的开始" class="headerlink" title="新的开始"></a>新的开始</h3><p>一直想有个地方，专门承载一些自己的小兴趣，记录自己的成长</p><p>用过简书，虽然很好的支持Markdown，但是草稿多了搜索是个问题，所以暂时不用了。</p><p>用过Evernote，虽然支持多端使用，但是不支持Markdown语法而且太封闭，加上自己又有输出和交流的念头，所以记录项目和写草稿。</p><p>那这个个人的小网站就是能满足自己需求的地方。</p><p>做技术是一个积累的过程，积累到一定程度是能够输出的，而且也会有及积极输出的欲望。</p><p>就目前来说，自己积累沉淀的内容质量并不高，适合自己的方式方法、主题及内容尚未成型</p><p>希望能看到内容的朋友能够多多给予意见和建议，以及一些正面反馈。</p><p>上小学的时候，学校举办一次自制校报的比赛，我就很没有创意的起名叫做”杂报”，</p><p>而且用毛笔在中间竖着写下蹩脚的”杂”字，看起来就像”九十八”。</p><p>再加上在注册域名备案时出了点绊子，最后不知道起什么名了，那就按照这个思路给网站起名叫”杂货铺”吧，域名就是现在的 <a href="https://blog.98store.top" target="_blank" rel="noopener">blog.98store.top</a> 。</p><p>网站内容也打算迎合网站名称，不只局限技术，放一些自己兴趣所在的东西。</p><p>不管怎样，还是</p><h1 id="欢迎您来到杂货铺"><a href="#欢迎您来到杂货铺" class="headerlink" title="欢迎您来到杂货铺"></a>欢迎您来到杂货铺</h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;新的开始&quot;&gt;&lt;a href=&quot;#新的开始&quot; class=&quot;headerlink&quot; title=&quot;新的开始&quot;&gt;&lt;/a&gt;新的开始&lt;/h3&gt;&lt;p&gt;一直想有个地方，专门承载一些自己的小兴趣，记录自己的成长&lt;/p&gt;
&lt;p&gt;用过简书，虽然很好的支持Markdown，但是草稿多
      
    
    </summary>
    
      <category term="归档" scheme="https://jjljyn.github.io/categories/%E5%BD%92%E6%A1%A3/"/>
    
    
      <category term="归档" scheme="https://jjljyn.github.io/tags/%E5%BD%92%E6%A1%A3/"/>
    
  </entry>
  
</feed>
